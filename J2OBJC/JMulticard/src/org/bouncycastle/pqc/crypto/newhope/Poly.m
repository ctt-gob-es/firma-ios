//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/desarrolloabamobile/Downloads/jmulticard-ios/src/main/java/org/bouncycastle/pqc/crypto/newhope/Poly.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "org/bouncycastle/crypto/digests/SHAKEDigest.h"
#include "org/bouncycastle/pqc/crypto/newhope/ChaCha20.h"
#include "org/bouncycastle/pqc/crypto/newhope/NTT.h"
#include "org/bouncycastle/pqc/crypto/newhope/Params.h"
#include "org/bouncycastle/pqc/crypto/newhope/Poly.h"
#include "org/bouncycastle/pqc/crypto/newhope/Precomp.h"
#include "org/bouncycastle/pqc/crypto/newhope/Reduce.h"
#include "org/bouncycastle/util/Pack.h"

#if !__has_feature(objc_arc)
#error "org/bouncycastle/pqc/crypto/newhope/Poly must be compiled with ARC (-fobjc-arc)"
#endif

@interface OrgBouncycastlePqcCryptoNewhopePoly ()

+ (jshort)normalizeWithShort:(jshort)x;

@end

__attribute__((unused)) static jshort OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(jshort x);

#line 1 "/Users/desarrolloabamobile/Downloads/jmulticard-ios/src/main/java/org/bouncycastle/pqc/crypto/newhope/Poly.java"


#line 6
@implementation OrgBouncycastlePqcCryptoNewhopePoly


#line 6
- (instancetype)initPackagePrivate {
  OrgBouncycastlePqcCryptoNewhopePoly_initPackagePrivate(self);
  return self;
}


#line 8
+ (void)addWithShortArray:(IOSShortArray *)x
           withShortArray:(IOSShortArray *)y
           withShortArray:(IOSShortArray *)z {
  OrgBouncycastlePqcCryptoNewhopePoly_addWithShortArray_withShortArray_withShortArray_(x, y, z);
}


#line 16
+ (void)fromBytesWithShortArray:(IOSShortArray *)r
                  withByteArray:(IOSByteArray *)a {
  OrgBouncycastlePqcCryptoNewhopePoly_fromBytesWithShortArray_withByteArray_(r, a);
}


#line 32
+ (void)fromNTTWithShortArray:(IOSShortArray *)r {
  OrgBouncycastlePqcCryptoNewhopePoly_fromNTTWithShortArray_(r);
}


#line 39
+ (void)getNoiseWithShortArray:(IOSShortArray *)r
                 withByteArray:(IOSByteArray *)seed
                      withByte:(jbyte)nonce {
  OrgBouncycastlePqcCryptoNewhopePoly_getNoiseWithShortArray_withByteArray_withByte_(r, seed, nonce);
}


#line 63
+ (void)pointWiseWithShortArray:(IOSShortArray *)x
                 withShortArray:(IOSShortArray *)y
                 withShortArray:(IOSShortArray *)z {
  OrgBouncycastlePqcCryptoNewhopePoly_pointWiseWithShortArray_withShortArray_withShortArray_(x, y, z);
}


#line 73
+ (void)toBytesWithByteArray:(IOSByteArray *)r
              withShortArray:(IOSShortArray *)p {
  OrgBouncycastlePqcCryptoNewhopePoly_toBytesWithByteArray_withShortArray_(r, p);
}


#line 96
+ (void)toNTTWithShortArray:(IOSShortArray *)r {
  OrgBouncycastlePqcCryptoNewhopePoly_toNTTWithShortArray_(r);
}


#line 102
+ (void)uniformWithShortArray:(IOSShortArray *)a
                withByteArray:(IOSByteArray *)seed {
  OrgBouncycastlePqcCryptoNewhopePoly_uniformWithShortArray_withByteArray_(a, seed);
}


#line 136
+ (jshort)normalizeWithShort:(jshort)x {
  return OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(x);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 0, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 2, 3, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 4, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 6, 7, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 8, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 9, 10, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 11, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 12, 3, -1, -1, -1, -1 },
    { NULL, "S", 0xa, 13, 14, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initPackagePrivate);
  methods[1].selector = @selector(addWithShortArray:withShortArray:withShortArray:);
  methods[2].selector = @selector(fromBytesWithShortArray:withByteArray:);
  methods[3].selector = @selector(fromNTTWithShortArray:);
  methods[4].selector = @selector(getNoiseWithShortArray:withByteArray:withByte:);
  methods[5].selector = @selector(pointWiseWithShortArray:withShortArray:withShortArray:);
  methods[6].selector = @selector(toBytesWithByteArray:withShortArray:);
  methods[7].selector = @selector(toNTTWithShortArray:);
  methods[8].selector = @selector(uniformWithShortArray:withByteArray:);
  methods[9].selector = @selector(normalizeWithShort:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "add", "[S[S[S", "fromBytes", "[S[B", "fromNTT", "[S", "getNoise", "[S[BB", "pointWise", "toBytes", "[B[S", "toNTT", "uniform", "normalize", "S" };
  static const J2ObjcClassInfo _OrgBouncycastlePqcCryptoNewhopePoly = { "Poly", "org.bouncycastle.pqc.crypto.newhope", ptrTable, methods, NULL, 7, 0x0, 10, 0, -1, -1, -1, -1, -1 };
  return &_OrgBouncycastlePqcCryptoNewhopePoly;
}

@end


#line 6
void OrgBouncycastlePqcCryptoNewhopePoly_initPackagePrivate(OrgBouncycastlePqcCryptoNewhopePoly *self) {
  NSObject_init(self);
}


#line 6
OrgBouncycastlePqcCryptoNewhopePoly *new_OrgBouncycastlePqcCryptoNewhopePoly_initPackagePrivate() {
  J2OBJC_NEW_IMPL(OrgBouncycastlePqcCryptoNewhopePoly, initPackagePrivate)
}


#line 6
OrgBouncycastlePqcCryptoNewhopePoly *create_OrgBouncycastlePqcCryptoNewhopePoly_initPackagePrivate() {
  J2OBJC_CREATE_IMPL(OrgBouncycastlePqcCryptoNewhopePoly, initPackagePrivate)
}


#line 8
void OrgBouncycastlePqcCryptoNewhopePoly_addWithShortArray_withShortArray_withShortArray_(IOSShortArray *x, IOSShortArray *y, IOSShortArray *z) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  for (jint i = 0; i < OrgBouncycastlePqcCryptoNewhopeParams_N; ++i) {
    
#line 12
    *IOSShortArray_GetRef(nil_chk(z), i) = OrgBouncycastlePqcCryptoNewhopeReduce_barrettWithShort_((jshort) (IOSShortArray_Get(nil_chk(x), i) + IOSShortArray_Get(nil_chk(y), i)));
  }
}


#line 16
void OrgBouncycastlePqcCryptoNewhopePoly_fromBytesWithShortArray_withByteArray_(IOSShortArray *r, IOSByteArray *a) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  for (jint i = 0; i < JreIntDiv(OrgBouncycastlePqcCryptoNewhopeParams_N, 4); ++i) {
    
#line 20
    jint j = 7 * i;
    jint a0 = IOSByteArray_Get(nil_chk(a), j + 0) & (jint) 0xFF;
    
#line 21
    jint a1 = IOSByteArray_Get(a, j + 1) & (jint) 0xFF;
    
#line 21
    jint a2 = IOSByteArray_Get(a, j + 2) & (jint) 0xFF;
    
#line 21
    jint a3 = IOSByteArray_Get(a, j + 3) & (jint) 0xFF;
    
#line 21
    jint a4 =
#line 22
    IOSByteArray_Get(a, j + 4) & (jint) 0xFF;
    
#line 21
    jint a5 =
#line 22
    IOSByteArray_Get(a, j + 5) & (jint) 0xFF;
    
#line 21
    jint a6 =
#line 22
    IOSByteArray_Get(a, j + 6) & (jint) 0xFF;
    
#line 24
    jint k = 4 * i;
    *IOSShortArray_GetRef(nil_chk(r), k + 0) = (jshort) (a0 | (JreLShift32((a1 & (jint) 0x3F), 8)));
    *IOSShortArray_GetRef(r, k + 1) = (jshort) ((JreURShift32(a1, 6)) | (JreLShift32(a2, 2)) | (JreLShift32((a3 & (jint) 0x0F), 10)));
    *IOSShortArray_GetRef(r, k + 2) = (jshort) ((JreURShift32(a3, 4)) | (JreLShift32(a4, 4)) | (JreLShift32((a5 & (jint) 0x03), 12)));
    *IOSShortArray_GetRef(r, k + 3) = (jshort) ((JreURShift32(a5, 2)) | (JreLShift32(a6, 6)));
  }
}


#line 32
void OrgBouncycastlePqcCryptoNewhopePoly_fromNTTWithShortArray_(IOSShortArray *r) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  OrgBouncycastlePqcCryptoNewhopeNTT_bitReverseWithShortArray_(r);
  OrgBouncycastlePqcCryptoNewhopeNTT_coreWithShortArray_withShortArray_(r, JreLoadStatic(OrgBouncycastlePqcCryptoNewhopePrecomp, OMEGAS_INV_MONTGOMERY));
  OrgBouncycastlePqcCryptoNewhopeNTT_mulCoefficientsWithShortArray_withShortArray_(r, JreLoadStatic(OrgBouncycastlePqcCryptoNewhopePrecomp, PSIS_INV_MONTGOMERY));
}

void OrgBouncycastlePqcCryptoNewhopePoly_getNoiseWithShortArray_withByteArray_withByte_(IOSShortArray *r, IOSByteArray *seed, jbyte nonce) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  IOSByteArray *iv = [IOSByteArray newArrayWithLength:8];
  *IOSByteArray_GetRef(iv, 0) = nonce;
  
#line 44
  IOSByteArray *buf = [IOSByteArray newArrayWithLength:4 * OrgBouncycastlePqcCryptoNewhopeParams_N];
  OrgBouncycastlePqcCryptoNewhopeChaCha20_processWithByteArray_withByteArray_withByteArray_withInt_withInt_(seed, iv, buf, 0, buf->size_);
  
#line 47
  for (jint i = 0; i < OrgBouncycastlePqcCryptoNewhopeParams_N; ++i) {
    
#line 49
    jint t = OrgBouncycastleUtilPack_bigEndianToIntWithByteArray_withInt_(buf, i * 4);
    
#line 52
    jint d = 0;
    for (jint j = 0; j < 8; ++j) {
      
#line 55
      d += (JreRShift32(t, j)) & (jint) 0x01010101;
    }
    jint a = ((JreURShift32(d, 24)) + (JreURShift32(d, 0))) & (jint) 0xFF;
    jint b = ((JreURShift32(d, 16)) + (JreURShift32(d, 8))) & (jint) 0xFF;
    *IOSShortArray_GetRef(nil_chk(r), i) = (jshort) (a + OrgBouncycastlePqcCryptoNewhopeParams_Q - b);
  }
}


#line 63
void OrgBouncycastlePqcCryptoNewhopePoly_pointWiseWithShortArray_withShortArray_withShortArray_(IOSShortArray *x, IOSShortArray *y, IOSShortArray *z) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  for (jint i = 0; i < OrgBouncycastlePqcCryptoNewhopeParams_N; ++i) {
    
#line 67
    jint xi = IOSShortArray_Get(nil_chk(x), i) & (jint) 0xFFFF;
    
#line 67
    jint yi = IOSShortArray_Get(nil_chk(y), i) & (jint) 0xFFFF;
    jshort t = OrgBouncycastlePqcCryptoNewhopeReduce_montgomeryWithInt_(3186 * yi);
    *IOSShortArray_GetRef(nil_chk(z), i) = OrgBouncycastlePqcCryptoNewhopeReduce_montgomeryWithInt_(xi * (t & (jint) 0xFFFF));
  }
}


#line 73
void OrgBouncycastlePqcCryptoNewhopePoly_toBytesWithByteArray_withShortArray_(IOSByteArray *r, IOSShortArray *p) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  for (jint i = 0; i < JreIntDiv(OrgBouncycastlePqcCryptoNewhopeParams_N, 4); ++i) {
    
#line 77
    jint j = 4 * i;
    
#line 80
    jshort t0 = OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(IOSShortArray_Get(nil_chk(p), j + 0));
    jshort t1 = OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(IOSShortArray_Get(p, j + 1));
    jshort t2 = OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(IOSShortArray_Get(p, j + 2));
    jshort t3 = OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(IOSShortArray_Get(p, j + 3));
    
#line 85
    jint k = 7 * i;
    *IOSByteArray_GetRef(nil_chk(r), k + 0) = (jbyte) t0;
    *IOSByteArray_GetRef(r, k + 1) = (jbyte) ((JreRShift32(t0, 8)) | (JreLShift32(t1, 6)));
    *IOSByteArray_GetRef(r, k + 2) = (jbyte) (JreRShift32(t1, 2));
    *IOSByteArray_GetRef(r, k + 3) = (jbyte) ((JreRShift32(t1, 10)) | (JreLShift32(t2, 4)));
    *IOSByteArray_GetRef(r, k + 4) = (jbyte) (JreRShift32(t2, 4));
    *IOSByteArray_GetRef(r, k + 5) = (jbyte) ((JreRShift32(t2, 12)) | (JreLShift32(t3, 2)));
    *IOSByteArray_GetRef(r, k + 6) = (jbyte) (JreRShift32(t3, 6));
  }
}


#line 96
void OrgBouncycastlePqcCryptoNewhopePoly_toNTTWithShortArray_(IOSShortArray *r) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  OrgBouncycastlePqcCryptoNewhopeNTT_mulCoefficientsWithShortArray_withShortArray_(r, JreLoadStatic(OrgBouncycastlePqcCryptoNewhopePrecomp, PSIS_BITREV_MONTGOMERY));
  OrgBouncycastlePqcCryptoNewhopeNTT_coreWithShortArray_withShortArray_(r, JreLoadStatic(OrgBouncycastlePqcCryptoNewhopePrecomp, OMEGAS_MONTGOMERY));
}

void OrgBouncycastlePqcCryptoNewhopePoly_uniformWithShortArray_withByteArray_(IOSShortArray *a, IOSByteArray *seed) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  OrgBouncycastleCryptoDigestsSHAKEDigest *xof = new_OrgBouncycastleCryptoDigestsSHAKEDigest_initWithInt_(128);
  [xof updateWithByteArray:seed withInt:0 withInt:((IOSByteArray *) nil_chk(seed))->size_];
  
#line 107
  jint pos = 0;
  for (; ; ) {
    
#line 110
    IOSByteArray *output = [IOSByteArray newArrayWithLength:256];
    [xof doOutputWithByteArray:output withInt:0 withInt:output->size_];
    
#line 113
    for (jint i = 0; i < output->size_; i += 2) {
      
#line 115
      jint val = (IOSByteArray_Get(output, i) & (jint) 0xFF) | (JreLShift32((IOSByteArray_Get(output, i + 1) & (jint) 0xFF), 8));
      if (val < 5 * OrgBouncycastlePqcCryptoNewhopeParams_Q) {
        
#line 118
        *IOSShortArray_GetRef(nil_chk(a), pos++) = (jshort) val;
        if (pos == OrgBouncycastlePqcCryptoNewhopeParams_N) {
          
#line 121
          return;
        }
      }
    }
  }
}


#line 136
jshort OrgBouncycastlePqcCryptoNewhopePoly_normalizeWithShort_(jshort x) {
  OrgBouncycastlePqcCryptoNewhopePoly_initialize();
  jint t = OrgBouncycastlePqcCryptoNewhopeReduce_barrettWithShort_(x);
  jint m = t - OrgBouncycastlePqcCryptoNewhopeParams_Q;
  jint c = JreRShift32(m, 31);
  t = m ^ ((t ^ m) & c);
  return (jshort) t;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgBouncycastlePqcCryptoNewhopePoly)
